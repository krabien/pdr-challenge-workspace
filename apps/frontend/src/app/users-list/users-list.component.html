<div class="users-list">
  <h2 class="title">Users (Material Table)</h2>

  @if (usersService.loading$ | async) {
    <div class="loading">
      <mat-spinner diameter="32"></mat-spinner>
      <span>Loading users…</span>
    </div>
  }

  @if (usersService.users$ | async; as users) {
    @if (users.length === 0) {
      <div class="empty">No users found.</div>
    } @else {
      <div class="controls">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search by name</mat-label>
          <input matInput type="text" (input)="applyFilter($any($event.target).value)" placeholder="e.g. Jane Doe" aria-label="Search users by full name" />
        </mat-form-field>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z2">
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let user"> {{ user.id }} </td>
          </ng-container>

          <!-- First Name Column -->
          <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef> First Name </th>
            <td mat-cell *matCellDef="let user"> {{ user.firstName }} </td>
          </ng-container>

          <!-- Last Name Column -->
          <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef> Last Name </th>
            <td mat-cell *matCellDef="let user"> {{ user.lastName }} </td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef> Email </th>
            <td mat-cell *matCellDef="let user"> {{ user.email || '—' }} </td>
          </ng-container>

          <!-- Role Column -->
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef> Role </th>
            <td mat-cell *matCellDef="let user"> {{ user.role }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              class="clickable-row"
              role="button"
              tabindex="0"
              (click)="openDetails(row)"
              (keydown.enter)="openDetails(row)"
              (keydown.space)="openDetails(row)"></tr>
        </table>
        <mat-paginator [pageSize]="25" [pageSizeOptions]="[5, 10, 25, 50]" showFirstLastButtons aria-label="Select page">
        </mat-paginator>
      </div>
    }
  }
</div>
